# 熱シミュレーションアプリケーション

本アプリケーションは、熱ネットワークの動的シミュレーションとパラメータ推定を行うWebアプリケーションです。React + TypeScript + Viteで構築されており、熱伝導問題の解析に特化した機能を提供します。

## 物理的背景理論

### 熱伝導の基礎方程式

熱ネットワーク解析は、フーリエの熱伝導法則に基づいています：

```
q = -k∇T
```

ここで：
- `q`: 熱流束 [W/m²]
- `k`: 熱伝導率 [W/(m·K)]
- `∇T`: 温度勾配 [K/m]

離散化された熱ネットワークでは、各ノード間の熱流量は以下の式で表現されます：

```
Q_{ij} = G_{ij}(T_j - T_i)
```

ここで：
- `Q_{ij}`: ノードiからノードjへの熱流量 [W]
- `G_{ij}`: ノードi-j間の熱コンダクタンス [W/K]
- `T_i, T_j`: 各ノードの温度 [K]

### 熱容量とエネルギー保存

各ノードでのエネルギー保存則は以下のように記述されます：

```
C_i dT_i/dt = Σ Q_{ij} + Q_{ext,i}
```

ここで：
- `C_i`: ノードiの熱容量 [J/K]
- `T_i`: ノードiの温度 [K]
- `t`: 時間 [s]
- `Q_{ext,i}`: ノードiへの外部熱入力 [W]

## 数値解法

### オイラー法による時間積分

本システムでは、熱ネットワークの時間発展を前進オイラー法（明示的オイラー法）で解いています：

```
T_i^{n+1} = T_i^n + Δt · (dT_i/dt)^n
```

具体的な実装では：

```
dT_i/dt = (1/C_i) · Σ G_{ij}(T_j - T_i)
```

### 計算アルゴリズム

1. **初期化**: 各ノードの初期温度を設定
2. **隣接リスト構築**: 効率的な熱流計算のためのデータ構造作成
3. **時間ステップループ**:
   - 各ノードの正味熱流量計算
   - 温度変化率の算出
   - 次の時刻の温度更新
   - 境界条件（固定温度ノード）の適用

### 安定性条件

明示的オイラー法の安定性のため、時間刻み `Δt` は以下の条件を満たす必要があります：

```
Δt < min(C_i / Σ G_{ij})
```

この条件を満たさない場合、数値不安定が発生する可能性があります。

## パラメータ推定手法

### 逆問題としての定式化

パラメータ推定は、測定温度データから熱容量とコンダクタンスを推定する逆問題として定式化されます：

**目的関数**:
```
J(θ) = (1/2) Σ [T_{measured}(t_k) - T_{simulated}(t_k, θ)]²
```

ここで：
- `θ`: 推定パラメータベクトル（熱容量、コンダクタンス）
- `T_{measured}`: 実測温度データ
- `T_{simulated}`: シミュレーション計算温度

### ガウス・ニュートン法

本システムでは、ガウス・ニュートン法を用いて非線形最小二乗問題を解いています：

```
θ^{k+1} = θ^k - α(J^T J + λI)^{-1} J^T r
```

ここで：
- `J`: ヤコビアン行列（感度行列）
- `r`: 残差ベクトル
- `α`: 学習率
- `λ`: レーベンバーグ・マルカート正則化パラメータ

### ヤコビアン行列の計算

感度解析のため、各パラメータに対する温度の偏微分を数値的に計算します：

```
∂T_i/∂θ_j ≈ [T_i(θ_j + ε) - T_i(θ_j)] / ε
```

### 収束判定

以下の条件で収束を判定します：
- **RMSE基準**: `√(Σr²/N) < tolerance`
- **最大反復回数**: 発散防止のため上限設定

### パラメータ制約

物理的な意味を保つため、以下の制約を適用：
- 熱容量 `C_i > 0.1` [J/K]
- コンダクタンス `G_{ij} ≥ 0` [W/K]

## 実装詳細

### 主要関数

- `simulateThermalNetwork()`: 熱ネットワークのシミュレーション実行
- `estimateParameters()`: パラメータ推定アルゴリズム
- `computeJacobian()`: ヤコビアン行列の数値計算
- `generateSampleData()`: ノイズ付きサンプルデータ生成

### エラーハンドリング

- 物理的制約違反の検出
- 数値計算の発散監視
- 収束性の評価

## サンプルシナリオ

システムには3つのテストシナリオが用意されています：

1. **シンプル2ノード**: 基本的な熱伝導テスト
2. **3ノード複合**: 複数接続による複雑なネットワーク
3. **多ノード応用**: 実用的な熱解析シナリオ

各シナリオには既知の真値パラメータが設定されており、推定精度の検証が可能です。

## 使用方法

1. アプリケーション起動: `npm run dev`
2. ノード配置と接続設定
3. 初期条件・境界条件の設定
4. シミュレーション実行
5. 必要に応じてパラメータ推定実行

## 注意事項

- 時間刻みは安定性条件を考慮して設定してください
- パラメータ推定は初期値に依存するため、物理的に妥当な初期推定値を使用してください
- 測定データにノイズが多い場合、正則化パラメータの調整が必要な場合があります

## 開発環境

詳細な開発コマンドや設定については、`CLAUDE.md`を参照してください。